<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Dual Reactor Core</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: transparent;
  overflow: hidden;
}

.container {
  width: 520px;
  height: 220px;
  display: flex;
  justify-content: space-evenly;
  align-items: center;
}

canvas {
  background: transparent;
}
</style>
</head>

<body>

<div class="container">
  <canvas id="weekly" width="220" height="220"></canvas>
  <canvas id="monthly" width="220" height="220"></canvas>
</div>

<script>
const API_URL = "https://trading-dashboard-api-five.vercel.app/api/engine-ui";

function Reactor(canvas, palette, motionSpeed) {
  const ctx = canvas.getContext("2d");
  const C = { x: canvas.width/2, y: canvas.height/2 };
  const R = 66;
  const IR = 52;

  let wave = 0;
  let breathe = 0;

  function drawDepth() {
    const g = ctx.createRadialGradient(C.x, C.y, 20, C.x, C.y, IR);
    g.addColorStop(0, "rgba(255,255,255,0.05)");
    g.addColorStop(1, "rgba(0,0,0,0.35)");
    ctx.beginPath();
    ctx.arc(C.x, C.y, IR, 0, Math.PI*2);
    ctx.fillStyle = g;
    ctx.fill();
  }

  function drawRing(color, glow, alive) {
    breathe += alive ? 0.015 : 0.005;
    const blur = alive ? 28 + Math.sin(breathe)*10 : 12;

    ctx.beginPath();
    ctx.arc(C.x, C.y, R, 0, Math.PI*2);
    ctx.strokeStyle = color;
    ctx.lineWidth = 8;
    ctx.shadowColor = glow;
    ctx.shadowBlur = blur;
    ctx.stroke();
    ctx.shadowBlur = 0;
  }

  function drawFuel(level, color) {
    if (level <= 0) return;

    const h = IR * 2 * level;
    const base = C.y + IR;
    const surface = base - h;

    ctx.save();
    ctx.beginPath();
    ctx.arc(C.x, C.y, IR, 0, Math.PI*2);
    ctx.clip();

    ctx.beginPath();
    ctx.moveTo(C.x - IR, surface);
    for (let x=-IR; x<=IR; x++) {
      ctx.lineTo(
        C.x + x,
        surface + Math.sin((x+wave)*0.045)*3
      );
    }
    ctx.lineTo(C.x + IR, base);
    ctx.lineTo(C.x - IR, base);
    ctx.closePath();

    const g = ctx.createLinearGradient(0, surface, 0, base);
    g.addColorStop(0, "rgba(200,255,235,0.95)");
    g.addColorStop(1, color);

    ctx.fillStyle = g;
    ctx.shadowColor = color;
    ctx.shadowBlur = 14;
    ctx.fill();
    ctx.restore();
  }

  function render(data) {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawDepth();

    let state = "IDLE";
    if (data.hasTrades) {
      if (data.pl > 0) state = "HEALTHY";
      else if (data.pl < 0) state = "WARNING";
      else state = "BREAKEVEN";
    }

    const styles = {
      IDLE:     { ring:"#999", glow:"rgba(150,150,150,.3)", fuel:0 },
      BREAKEVEN:{ ring:palette.ring, glow:palette.glow, fuel:0 },
      HEALTHY:  { ring:palette.ring, glow:palette.glow, fuel:data.progress },
      WARNING:  { ring:"rgba(255,170,90,.8)", glow:"rgba(255,170,90,.4)", fuel:0 }
    };

    const s = styles[state];
    drawRing(s.ring, s.glow, state==="HEALTHY");
    drawFuel(s.fuel, palette.fuel);

    wave += motionSpeed;
    requestAnimationFrame(() => render(data));
  }

  return render;
}

/* ================= INIT ================= */

const weeklyReactor = Reactor(
  document.getElementById("weekly"),
  { ring:"rgba(120,255,220,1)", glow:"rgba(120,255,220,1)", fuel:"rgba(120,255,220,.7)" },
  0.35
);

const monthlyReactor = Reactor(
  document.getElementById("monthly"),
  { ring:"rgba(90,220,160,1)", glow:"rgba(90,220,160,1)", fuel:"rgba(90,220,160,.7)" },
  0.2
);

async function loop() {
  try {
    const res = await fetch(API_URL, { cache:"no-store" });
    const json = await res.json();
    weeklyReactor(json.weekly);
    monthlyReactor(json.monthly);
  } catch {}
  setTimeout(loop, 8000);
}

loop();
</script>

</body>
</html>
