<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Finance Alerts</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: transparent; /* ✅ allow Notion to show through */
  overflow: hidden;
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  color: #eaeaea;
}

/* ===== SAFE ZONE (NO SOLID FILL) ===== */
.safe-zone {
  position: absolute;
  inset: 0;
  padding: 18px 16px;
  box-sizing: border-box;
  overflow: hidden;
}

/* ===== SOFT DEPTH + BLEND (REACTOR STYLE) ===== */
.safe-zone::before {
  content: "";
  position: absolute;
  inset: 0;
  background:
    radial-gradient(
      ellipse at center,
      rgba(0,0,0,0.15) 0%,
      rgba(0,0,0,0.22) 45%,
      rgba(0,0,0,0.38) 100%
    );
  pointer-events: none;
  z-index: 0;
}

/* Ultra-faint inner panel edge */
.safe-zone::after {
  content: "";
  position: absolute;
  inset: 0;
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,0.03),
    inset 0 0 24px rgba(0,0,0,0.45);
  pointer-events: none;
  z-index: 1;
}

/* Ensure content is above overlays */
.safe-zone > * {
  position: relative;
  z-index: 2;
}

/* ===== HEADER ===== */
.header {
  margin-bottom: 14px;
}

.header h1 {
  font-size: 16px;
  font-weight: 600;
  margin: 0;
}

.header span {
  font-size: 11px;
  opacity: 0.6;
}

/* ===== SECTIONS ===== */
.section {
  margin-top: 14px;
}

.section-title {
  font-size: 11px;
  letter-spacing: 0.08em;
  opacity: 0.6;
  margin-bottom: 6px;
}

/* ===== CARD ITEM ===== */
.item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 12px;
  border-radius: 12px;
  margin-bottom: 8px;

  background: rgba(255,255,255,0.04);
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,0.03),
    inset 0 0 18px rgba(0,0,0,0.5);
}

/* Status tints */
.item.overdue {
  background: linear-gradient(
    90deg,
    rgba(180,60,60,0.28),
    rgba(255,255,255,0.04)
  );
}

.item.due {
  background: linear-gradient(
    90deg,
    rgba(220,150,60,0.24),
    rgba(255,255,255,0.04)
  );
}

.item.paid {
  background: rgba(120,160,140,0.18);
}

/* ===== TEXT ===== */
.item-left {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.item-title {
  font-size: 13px;
  font-weight: 500;
}

.item-sub {
  font-size: 11px;
  opacity: 0.7;
}

.item-right {
  font-size: 13px;
  font-weight: 500;
  opacity: 0.9;
}

/* ===== PAYMENT GROUP ===== */
.payment-day {
  margin-top: 10px;
}

.payment-label {
  font-size: 11px;
  opacity: 0.5;
  margin-bottom: 6px;
}
</style>
</head>

<body>
<div class="safe-zone">
  <div class="header">
    <h1>Finance Alerts</h1>
    <span>Auto-generated · IST</span>
  </div>

  <div id="content"></div>
</div>

<script>
async function loadData() {
  const res = await fetch("/api/widget/view", { cache: "no-store" });
  const data = await res.json();
  render(data);
}

function el(tag, cls, txt) {
  const e = document.createElement(tag);
  if (cls) e.className = cls;
  if (txt) e.textContent = txt;
  return e;
}

function render(view) {
  const root = document.getElementById("content");

  const cards = view.cards;

  function renderCardSection(title, items, cls) {
    if (!items.length) return;
    const sec = el("div", "section");
    sec.appendChild(el("div", "section-title", title));
    items.forEach(i => {
      const row = el("div", `item ${cls}`);
      const left = el("div", "item-left");
      left.appendChild(el("div", "item-title", `${i.provider} • ${i.last4}`));
      left.appendChild(el("div", "item-sub", i.rules.status_label));
      const right = el("div", "item-right",
        i.amount_due ? `₹${i.amount_due}` : ""
      );
      row.append(left, right);
      sec.appendChild(row);
    });
    root.appendChild(sec);
  }

  renderCardSection("OVERDUE", cards.overdue, "overdue");
  renderCardSection("DUE", cards.due, "due");
  renderCardSection(
    "PAID",
    cards.paid.filter(i => i.rules.visibility === "visible"),
    "paid"
  );

  const payments = view.payments;
  const days = Object.keys(payments);

  if (days.length) {
    const sec = el("div", "section");
    sec.appendChild(el("div", "section-title", "PAYMENTS"));

    days.forEach(day => {
      const group = el("div", "payment-day");
      group.appendChild(el("div", "payment-label", payments[day].label));

      payments[day].items.forEach(p => {
        const row = el("div", "item paid");
        const left = el("div", "item-left");
        left.appendChild(el("div", "item-title",
          `${p.provider || "Payment"}`
        ));
        left.appendChild(el("div", "item-sub",
          p.display_name || p.identifier || ""
        ));
        const right = el("div", "item-right",
          p.value ? `₹${p.value}` : ""
        );
        row.append(left, right);
        group.appendChild(row);
      });

      sec.appendChild(group);
    });

    root.appendChild(sec);
  }
}

loadData();
</script>
</body>
</html>
