<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Trading Heat Strip</title>

<style>
  body {
    margin: 0;
    background: transparent;
    overflow: hidden;
  }

  .fire-strip {
    position: relative;
    width: 100%;
    height: 85px;
    overflow: hidden;
  }

  /* ================= FLAMES ================= */
  .flame {
    position: absolute;
    bottom: 0;
    width: 6px;
    height: 55%;
    border-radius: 50% 50% 45% 45%;
    background: linear-gradient(
      to top,
      rgba(200,235,255,0.95) 0%,
      rgba(140,200,255,0.85) 30%,
      rgba(80,160,255,0.75) 60%,
      rgba(40,120,220,0.65) 80%,
      transparent 100%
    );
    filter: blur(0.6px);
    box-shadow:
      0 0 6px rgba(120,190,255,var(--glow)),
      0 0 14px rgba(60,140,255,var(--glow));
    transform-origin: 50% 100%;
    animation:
      flameMove var(--speed) infinite ease-in-out,
      waveMove 10s infinite ease-in-out,
      bendMove var(--bendSpeed) infinite ease-in-out;
    animation-delay:
      var(--delay),
      0s,
      var(--bendDelay);
    opacity: 0.95;
  }

  /* ================= BASE GLOW ================= */
  .base-glow {
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 50%;
    background: radial-gradient(
      ellipse at center,
      rgba(120,190,255,0.55),
      rgba(60,120,220,0.25),
      transparent 78%
    );
    pointer-events: none;
  }

  /* ================= FOG (VISIBLE, SOFT) ================= */
  .fog {
    position: absolute;
    top: 10%;
    width: 100%;
    height: 45%;
    background:
      radial-gradient(
        ellipse at center,
        rgba(200,230,255,0.18),
        rgba(200,230,255,0.08),
        transparent 70%
      );
    filter: blur(10px);
    opacity: 0;
    animation: fogDrift 9s infinite ease-in-out;
    pointer-events: none;
  }

  @keyframes fogDrift {
    0%   { opacity: 0; transform: translateY(0); }
    25%  { opacity: 0.35; }
    60%  { opacity: 0.4; transform: translateY(-6px); }
    100% { opacity: 0; transform: translateY(-12px); }
  }

  /* ================= SPARKS ================= */
  .spark {
    position: absolute;
    bottom: 50%;
    width: 2px;
    height: var(--h);
    background: linear-gradient(
      to top,
      rgba(200,235,255,var(--o)),
      rgba(140,200,255,0.5),
      transparent
    );
    border-radius: 50%;
    animation: sparkFly 1.9s ease-out forwards;
    pointer-events: none;
  }

  @keyframes flameMove {
    0%   { transform: scaleY(0.88); }
    45%  { transform: scaleY(1.08); }
    100% { transform: scaleY(0.92); }
  }

  @keyframes waveMove {
    0%   { filter: brightness(0.95); }
    50%  { filter: brightness(1.05); }
    100% { filter: brightness(0.95); }
  }

  @keyframes bendMove {
    0%   { rotate: -1.4deg; }
    50%  { rotate: 1.4deg; }
    100% { rotate: -1.4deg; }
  }

  @keyframes sparkFly {
    0%   { transform: translateY(0) scaleY(1); opacity: 1; }
    100% { transform: translateY(-38px) scaleY(0.2); opacity: 0; }
  }
</style>
</head>

<body>

<div class="fire-strip" id="fire">
  <div class="base-glow"></div>
  <div class="fog"></div>
</div>

<script>
const API = "https://trading-dashboard-api-five.vercel.app/api/engine-ui";
const fire = document.getElementById("fire");

let weeklyProgress = 0;

/* ================= FETCH ENGINE UI ================= */
async function fetchData() {
  try {
    const r = await fetch(API + "?t=" + Date.now(), { cache: "no-store" });
    const d = await r.json();
    weeklyProgress = Math.max(0, Math.min(1, d.weekly?.progress ?? 0));
  } catch {}
}
fetchData();
setInterval(fetchData, 10000);

/* ================= BUILD FLAMES ================= */
const flameSpacingPx = 9;
const flameCount = Math.floor(fire.clientWidth / flameSpacingPx);

for (let i = 0; i < flameCount; i++) {
  const f = document.createElement("div");
  f.className = "flame";

  f.style.left = `${i * flameSpacingPx + (Math.random() * 2 - 1)}px`;
  f.style.setProperty("--speed", `${2.7 + Math.random() * 0.9}s`);
  f.style.setProperty("--bendSpeed", `${6.5 + Math.random() * 3}s`);
  f.style.setProperty("--bendDelay", `${Math.random() * 4}s`);
  f.style.setProperty("--delay", `${(i / flameCount) * 3}s`);
  f.style.height = `${48 + Math.random() * 10}%`;

  fire.appendChild(f);
}

/* ================= ANIMATE GLOW FROM PROGRESS ================= */
function applyGlow() {
  const glow = 0.25 + weeklyProgress * 0.75;
  document.querySelectorAll(".flame").forEach(f =>
    f.style.setProperty("--glow", glow.toFixed(2))
  );
  requestAnimationFrame(applyGlow);
}
applyGlow();

/* ================= SPARKS ================= */
setInterval(() => {
  const s = document.createElement("div");
  s.className = "spark";
  s.style.left = `${Math.random() * 100}%`;
  s.style.setProperty("--h", `${10 + Math.random() * 10}px`);
  s.style.setProperty("--o", `${0.5 + Math.random() * 0.3}`);
  fire.appendChild(s);
  setTimeout(() => s.remove(), 1900);
}, 320);
</script>

</body>
</html>