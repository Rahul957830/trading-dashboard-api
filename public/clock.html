<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Discipline Clock</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: rgba(16,16,16,0.98);
}

/* Full iframe-safe zone */
.safe-zone {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(16,16,16,0.98);
  overflow: hidden;
  border-radius: 16px;
}

/* Ultra-faint inner panel border */
.safe-zone::after {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: 16px;
 box-shadow:
  inset 0 0 0 1px rgba(255,255,255,0.20),   /* visible inner edge */
  inset 0 0 14px rgba(255,255,255,0.04);   /* soft inner glow */
  pointer-events: none;
  z-index: 1;
}

/* Expanded vignette */
.safe-zone::before {
  content: "";
  position: absolute;
  inset: 0;
  background: radial-gradient(
    circle at center,
    rgba(0,0,0,0.12) 0%,
    rgba(0,0,0,0.10) 35%,
    rgba(0,0,0,0.18) 70%,
    rgba(0,0,0,0.30) 100%
  );
  border-radius: 16px;
  pointer-events: none;
  z-index: 0;
}

/* Tint variables */
:root {
  --marker-color: rgba(195,255,235,1);
  --hand-main: rgba(235,255,245,1);
  --hand-soft: rgba(215,255,240,1);
}

/* Clock styling */
.clock {
  position: relative;
  width: 200px;
  height: 200px;
  border-radius: 50%;
  background: transparent;
  box-shadow:
    inset 0 0 34px rgba(0,0,0,0.9),
    0 0 36px rgba(160,160,160,0.35);
  z-index: 1;
}

/* Inner depth */
.clock::before {
  content: "";
  position: absolute;
  inset: 6px;
  border-radius: 50%;
  box-shadow:
    inset 0 0 26px rgba(0,0,0,0.85),
    inset 0 0 12px rgba(255,255,255,0.04);
  pointer-events: none;
}

/* =========================================================
   ðŸ”¥ NEW: SOFT ENERGY HALO (replaces sharp glass glare)
   ========================================================= */
.clock::after {
  content: "";
  position: absolute;
  mix-blend-mode: screen;
  inset: -14px;                 /* pushes glow OUTSIDE dial */
  border-radius: 50%;
  pointer-events: none;

 background: radial-gradient(
  circle at center,
  rgba(140,255,205,0.00) 0%,
  rgba(140,255,205,0.06) 42%,
  rgba(140,255,205,0.16) 62%,
  rgba(140,255,205,0.00) 82%
),
   /* ðŸ”‘ ultra subtle radial noise */
    repeating-radial-gradient(
      circle at center,
      rgba(255,255,255,0.015) 0px,
      rgba(255,255,255,0.015) 1px,
      rgba(0,0,0,0.015) 2px,
      rgba(0,0,0,0.015) 3px
    
);

filter: blur(14px);          /* diffusion, not blur */
  opacity: 0.85;

  /* Ultra slow, safe breathing */
  animation: haloBreath 8s ease-in-out infinite;
}

/* Hour markers */
.marker {
  position: absolute;
  width: 3px;
  height: 12px;
  background: var(--marker-color);
  top: 12px;
  left: 50%;
  transform-origin: center 88px;
}

/* Hands */
.hand {
  position: absolute;
  top: 50%;
  left: 50%;
  transform-origin: 0% 50%;
  border-radius: 4px;
}

.hour {
  width: 28%;
  height: 5px;
  background: var(--hand-main);
  box-shadow: 0 0 24px rgba(140,255,205,1);
}

.minute {
  width: 42%;
  height: 3px;
  background: var(--hand-soft);
  box-shadow: 0 0 22px rgba(140,255,205,0.95);
}

.second {
  width: 46%;
  height: 2px;
  background: rgb(255,70,70);
  box-shadow:
    0 0 34px rgba(255,70,70,1),
    0 0 22px rgba(255,150,150,1);
}

/* Center dot */
.center-dot {
  position: absolute;
  width: 8px;
  height: 8px;
  background: var(--hand-main);
  border-radius: 50%;
  transform: translate(-50%, -50%);
  top: 50%;
  left: 50%;
  box-shadow: 0 0 12px rgba(140,255,205,0.7);
}

/* === Halo breathing === */
@keyframes haloBreath {
  0%   { opacity: 0.55; }
  50%  { opacity: 1; }
  100% { opacity: 0.55; }
}
</style>
</head>

<body>

<div class="safe-zone">
  <div class="clock" id="clock">

    <script>
      for (let i = 0; i < 12; i++) {
        document.write(
          `<div class="marker" style="transform: rotate(${i * 30}deg)"></div>`
        );
      }
    </script>

    <div class="hand hour" id="hour"></div>
    <div class="hand minute" id="minute"></div>
    <div class="hand second" id="second"></div>
    <div class="center-dot"></div>

  </div>
</div>

<script>
const clock = document.getElementById("clock");
const root = document.documentElement;
const hourHand = document.getElementById("hour");
const minuteHand = document.getElementById("minute");
const secondHand = document.getElementById("second");

/* restore last visual state */
const savedVisual = JSON.parse(localStorage.getItem("clockVisual") || "{}");
if (savedVisual.glow) clock.style.boxShadow = savedVisual.glow;
if (savedVisual.tints) {
  root.style.setProperty("--marker-color", savedVisual.tints.marker);
  root.style.setProperty("--hand-main", savedVisual.tints.main);
  root.style.setProperty("--hand-soft", savedVisual.tints.soft);
}

/* month progress */
function getMonthProgressAngle(now) {
  const day = now.getDate();
  const days = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
  return (day / days) * 360 - 90;
}

/* APPLY MONTHLY STATE */
async function applyMonthlyState() {
  try {
    const res = await fetch("/api/engine?t=" + Date.now());
    const data = await res.json();
    const pl = data.monthly.pl;

    let glow, tints;
    if (pl > 0) {
      glow = `inset 0 0 34px rgba(0,0,0,0.9), 0 0 60px rgba(120,255,195,0.95)`;
      tints = {
        marker: "rgba(195,255,235,1)",
        main: "rgba(235,255,245,1)",
        soft: "rgba(215,255,240,1)"
      };
    } else if (pl < 0) {
      glow = `inset 0 0 34px rgba(0,0,0,0.9), 0 0 60px rgba(240,90,90,0.9)`;
      tints = {
        marker: "rgba(220,230,230,0.9)",
        main: "rgba(230,235,235,0.95)",
        soft: "rgba(210,220,220,0.9)"
      };
    } else {
      glow = `inset 0 0 34px rgba(0,0,0,0.9), 0 0 36px rgba(160,160,160,0.35)`;
      tints = {
        marker: "rgba(190,190,190,0.8)",
        main: "rgba(210,210,210,0.9)",
        soft: "rgba(195,195,195,0.85)"
      };
    }

    clock.style.boxShadow = glow;
    root.style.setProperty("--marker-color", tints.marker);
    root.style.setProperty("--hand-main", tints.main);
    root.style.setProperty("--hand-soft", tints.soft);

    localStorage.setItem("clockVisual", JSON.stringify({ glow, tints }));
  } catch {}
}

/* Smooth motion */
function updateClock() {
  const now = new Date();
  const smoothSeconds = now.getSeconds() + now.getMilliseconds() / 1000;

  hourHand.style.transform = `rotate(${getMonthProgressAngle(now)}deg)`;
  minuteHand.style.transform = `rotate(${now.getMinutes() * 6 - 90}deg)`;
  secondHand.style.transform = `rotate(${smoothSeconds * 6 - 90}deg)`;

  requestAnimationFrame(updateClock);
}

/* Init */
updateClock();
applyMonthlyState();
setInterval(applyMonthlyState, 10000);
</script>

</body>
</html>
